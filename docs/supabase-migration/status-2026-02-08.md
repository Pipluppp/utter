# Status — Feb 8, 2026

Phases 01 through 07 of the Supabase backend migration are complete. The local stack (Supabase CLI + Edge Functions + React frontend) runs end-to-end on localhost. Auth is wired up — password sign-up/sign-in works instantly against the local Supabase instance (email confirmations are off for dev, so no Inbucket step needed for password flow).

We also did an initial frontend deployment to Vercel, separate from the migration phases. The React SPA is live on a Vercel preview URL, deployed from `refactor/backend-db-supabase`. There are no API rewrites yet — the deployment is purely the frontend for navigating pages and showing the landing. Pages that need backend data (Voices, History, Generate, etc.) degrade gracefully with error messages instead of crashing. The full API rewrite to Supabase Edge Functions comes later in Phase 10.

A few bugs surfaced during the Vercel deployment and were fixed: demo media files for the landing page weren't being committed (`.gitignore` pattern was too broad), the waveform player had black-on-black bars in dark mode due to a React effect ordering issue (ThemeProvider now uses `useLayoutEffect`), and API calls that received HTML instead of JSON (from the SPA fallback) now show clean error states instead of parse crashes.

Phase 08 (QA + security validation) is underway. A comprehensive CLI test suite (`scripts/phase08-test.sh`) ran **29 tests, 0 failures**, covering:

- **Auth**: both test users sign up/sign in instantly
- **Profile CRUD**: GET /me + PATCH /profile with persistence
- **Clone flow**: full 2-step signed-URL upload → finalize → voice appears in list
- **Generate flow**: POST /generate → task created → Modal job polling works (16+ polls, all valid JSON)
- **Multi-tenant RLS** (fully verified): User B cannot list, preview, or delete User A's data. User B creates own voice and sees only their own. Unauthenticated requests return 401.
- **PostgREST hardening**: direct INSERT into tasks/generations blocked (403), UPDATE voices blocked (403), anon writes blocked (401)
- **CORS**: Access-Control-Allow-Origin present on all responses, OPTIONS preflight returns 204
- **Security**: no `x-utter-user-id` debug header, no `service_role` key in frontend source or built bundle, no `MODAL_` env vars leaked, `.env.local` never committed, `autoRefreshToken: true` confirmed

Remaining Phase 08 items need manual browser testing: WaveSurfer rendering, audio playback, cancel/design/delete flows, double-poll finalize, console error sweep, and Network tab verification. After that, Phase 09 is staging deploy and Phase 10 is the full Vercel deployment with API rewrites pointing at Supabase.

---

## As Of Feb 12, 2026

- Local database regression suite is green after hardening updates: `npm run test:db` → **144/144 passing**.
- Local edge test suite is still blocked on this machine because `deno` is not installed (`npm run test:edge` fails with `deno: not found`).
- `frontend/vercel.json` still has SPA fallback only; `/api/*` rewrite wiring to staging Supabase is not configured yet.

Current deployment blockers before staging cutover:
- Run edge tests locally after installing Deno, or confirm CI `edge-function-tests` is green on the latest Supabase changes.
- Complete Phase 09 (staging deploy + smoke validation), then apply Phase 10 Vercel rewrite/env wiring.
